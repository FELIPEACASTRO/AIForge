# Prompt Ensembling

## Description
Prompt Ensembling (Conjunto de Prompts) é uma técnica avançada de Engenharia de Prompt que visa aumentar a precisão e a confiabilidade das respostas de Large Language Models (LLMs). A técnica envolve a criação de múltiplos prompts diferentes para a mesma questão, a geração de diversas respostas e, em seguida, a agregação ou verificação dessas respostas para chegar a um resultado final mais robusto. As abordagens variam, como: 1) **DiVeRSe** (Diverse Verifier on Reasoning Step), que usa diferentes exemplos few-shot para gerar diversidade e um verificador para validar os passos de raciocínio; 2) **AMA** (Ask Me Anything), que reformula a questão original de várias maneiras para criar diferentes 'visões' da tarefa; e 3) **Boosted Prompt Ensembles**, que seleciona exemplos few-shot 'difíceis' em etapas para construir um conjunto de prompts que se complementam.

## Examples
```
**Exemplo 1: Ensembling por Variação de Pergunta (AMA-like)**\n\n**Cenário:** Aumentar a confiabilidade de uma resposta factual e de raciocínio.\n**Pergunta Original:** Qual é a capital do Butão e por que ela foi escolhida?\n\n| Prompt | Tipo de Variação |\n| :--- | :--- |\n| **Prompt 1:** Forneça a capital do Butão e explique brevemente a razão histórica para sua escolha. | Direto e Factual |\n| **Prompt 2:** Dada a história e geografia do Butão, qual cidade serve como sua capital e quais fatores levaram a essa decisão? | Contextualizado e Racional |\n| **Prompt 3:** Eu preciso saber o nome da capital do Reino do Butão. Além disso, qual é o principal motivo para essa cidade ser a capital? | Linguagem mais informal/pessoal |\n| **Prompt 4:** Responda apenas com o nome da capital do Butão. Em uma segunda etapa, justifique a escolha. | Separação de Tarefas |\n\n**Agregação:** Votação majoritária para o nome da capital (Thimphu) e síntese das justificativas.\n\n---\n\n**Exemplo 2: Ensembling por Variação de Persona/Formato**\n\n**Cenário:** Gerar uma análise de mercado com diferentes focos.\n**Pergunta Original:** Analise o impacto da IA generativa no setor de design gráfico.\n\n| Prompt | Tipo de Variação |\n| :--- | :--- |\n| **Prompt 1:** Atue como um **consultor de tecnologia**. Analise o impacto da IA generativa no setor de design gráfico, focando em **eficiência e ferramentas**. Formato: Tópicos. | Foco em Tecnologia |\n| **Prompt 2:** Atue como um **designer gráfico sênior**. Analise o impacto da IA generativa no setor de design gráfico, focando em **criatividade e ética**. Formato: Parágrafos. | Foco em Criatividade/Ética |\n| **Prompt 3:** Atue como um **analista de negócios**. Analise o impacto da IA generativa no setor de design gráfico, focando em **custos e modelos de receita**. Formato: Tabela. | Foco em Negócios |\n\n**Agregação:** Combinação dos insights dos três prompts para uma análise 360 graus.\n\n---\n\n**Exemplo 3: Ensembling por Variação de Exemplos (DiVeRSe-like)**\n\n**Cenário:** Resolver um problema de raciocínio complexo (matemática).\n**Pergunta Original:** Se um trem viaja a 60 km/h e um carro a 80 km/h, e o trem saiu 1 hora antes, quando o carro o alcançará se a distância inicial é de 100 km?\n\n| Prompt | Tipo de Variação |\n| :--- | :--- |\n| **Prompt 1:** **Few-Shot A:** Inclui 3 exemplos de problemas de \"taxa de trabalho\" resolvidos. | Foco em problemas de Taxa de Trabalho |\n| **Prompt 2:** **Few-Shot B:** Inclui 3 exemplos de problemas de \"distância e tempo\" resolvidos. | Foco em problemas de Distância/Tempo |\n| **Prompt 3:** **Zero-Shot CoT:** Use o método \"Pense Passo a Passo\" antes de responder. | Foco em Raciocínio Explícito |\n\n**Agregação:** Votação majoritária no resultado final numérico. Se houver divergência, usar o resultado do prompt com o raciocínio mais lógico (Prompt 3).\n\n---\n\n**Exemplo 4: Ensembling para Classificação de Sentimento**\n\n**Cenário:** Classificar o sentimento de um texto ambíguo.\n**Texto:** \"O novo filme é... surpreendente. Não sei se de um jeito bom ou ruim, mas definitivamente me fez pensar.\"\n\n| Prompt | Tipo de Variação |\n| :--- | :--- |\n| **Prompt 1:** Classifique o sentimento do texto como POSITIVO, NEGATIVO ou NEUTRO. | Classificação Simples |\n| **Prompt 2:** Classifique o sentimento do texto em uma escala de 1 (Muito Negativo) a 5 (Muito Positivo). | Classificação Gradual |\n| **Prompt 3:** Classifique o sentimento e justifique sua escolha em uma frase. | Classificação com Justificativa |\n\n**Agregação:** Votação majoritária (ex: 2 votos para NEUTRO e 1 voto para 3/NEUTRO).\n\n---\n\n**Exemplo 5: Ensembling para Geração de Títulos**\n\n**Cenário:** Gerar títulos criativos e otimizados para um artigo de blog.\n**Tópico:** Os 5 maiores erros de SEO que empresas cometem.\n\n| Prompt | Tipo de Variação |\n| :--- | :--- |\n| **Prompt 1:** Gere 3 títulos de blog focados em **urgência e medo de perder**. | Foco em Emoção |\n| **Prompt 2:** Gere 3 títulos de blog focados em **benefício e solução de problemas**. | Foco em Solução |\n| **Prompt 3:** Gere 3 títulos de blog focados em **listas e números**. | Foco em Formato |\n\n**Agregação:** Seleção manual do melhor título entre os 9 gerados.\n\n---\n\n**Exemplo 6: Ensembling para Tradução de Termos Técnicos**\n\n**Cenário:** Traduzir um termo técnico para o português, garantindo a precisão do contexto.\n**Termo:** \"Context Window\"\n\n| Prompt | Tipo de Variação |\n| :--- | :--- |\n| **Prompt 1:** Traduza o termo \"Context Window\" no contexto de **Large Language Models**. | Contexto Específico |\n| **Prompt 2:** Traduza o termo \"Context Window\" no contexto de **programação de interface gráfica**. | Contexto Alternativo |\n| **Prompt 3:** Liste as 3 traduções mais comuns para \"Context Window\" e indique a mais precisa para LLMs. | Abordagem de Lista |\n\n**Agregação:** Escolha da tradução que aparece mais vezes e é validada pelo contexto (ex: \"Janela de Contexto\").\n\n---\n\n**Exemplo 7: Ensembling para Geração de Código**\n\n**Cenário:** Gerar um snippet de código Python para uma tarefa específica.\n**Tarefa:** Escreva uma função Python para calcular o fatorial de um número de forma recursiva.\n\n| Prompt | Tipo de Variação |\n| :--- | :--- |\n| **Prompt 1:** Escreva a função Python para o fatorial. Inclua **docstrings** e **type hints**. | Foco em Qualidade de Código |\n| **Prompt 2:** Escreva a função Python para o fatorial. Otimize para **velocidade** (se possível). | Foco em Performance |\n| **Prompt 3:** Escreva a função Python para o fatorial. Inclua um **exemplo de uso** com `if __name__ == \"__main__\":`. | Foco em Usabilidade |\n\n**Agregação:** Combinação do código funcional (Prompt 2) com os elementos de qualidade (docstrings/type hints do Prompt 1 e exemplo de uso do Prompt 3).\n\n---\n\n**Exemplo 8: Ensembling para Resposta a Perguntas de Múltipla Escolha**\n\n**Cenário:** Aumentar a confiança na resposta correta de um teste.\n**Pergunta:** Qual é o principal benefício do Prompt Ensembling? (A) Redução de custos (B) Aumento da latência (C) Maior confiabilidade da resposta (D) Simplificação do prompt.\n\n| Prompt | Tipo de Variação |\n| :--- | :--- |\n| **Prompt 1:** Responda à pergunta. Pense Passo a Passo. | CoT Simples |\n| **Prompt 2:** Responda à pergunta. Atue como um **professor de IA**. | Persona |\n| **Prompt 3:** Responda à pergunta. Inclua um **contra-argumento** para as opções incorretas. | Verificação de Raciocínio |\n\n**Agregação:** Votação majoritária na opção (C). Se 3/3 concordarem, a confiança é alta.
```

## Best Practices
1. **Diversificação Intencional:** Não apenas parafraseie, mas altere ativamente os elementos do prompt (exemplos few-shot, persona, formato de saída, reformulação da pergunta) para garantir a máxima diversidade de respostas. 2. **Votação Majoritária Simples:** Para a maioria dos casos de uso, a agregação por votação majoritária (o resultado mais comum entre as respostas) é a estratégia mais prática e eficaz. 3. **Verificação de Raciocínio:** Em tarefas complexas (como matemática ou raciocínio lógico), use um verificador (se disponível) ou peça ao LLM para justificar cada resposta para identificar erros de raciocínio. 4. **Use em Tarefas Críticas:** Aplique o Prompt Ensembling em tarefas onde a precisão é crítica e o custo de múltiplas chamadas à API é justificado.

## Use Cases
1. **Aumento da Confiabilidade em Fatos:** Obter uma resposta mais confiável para perguntas factuais, onde a concordância entre múltiplos prompts sugere maior veracidade. 2. **Resolução de Problemas Complexos:** Melhorar a precisão em tarefas de raciocínio, como problemas de matemática (GSM8K) ou lógica, ao agregar os resultados de diferentes caminhos de raciocínio. 3. **Estimativa de Incerteza:** Usar a dispersão das respostas do conjunto para estimar a incerteza do modelo sobre a questão (Bayesian Prompt Ensembles). 4. **Sumarização de Grande Escala:** Combinar múltiplas estratégias de prompt para gerar sumarizações mais completas e precisas.

## Pitfalls
1. **Custo Computacional Elevado:** A principal desvantagem é o aumento do custo e da latência, pois requer múltiplas chamadas à API do LLM. 2. **Agregação Ineficaz:** Se a estratégia de agregação (votação) for mal implementada ou se as respostas forem muito diversas, o resultado final pode ser inconclusivo ou incorreto. 3. **Diversidade Insuficiente:** Prompts que são apenas pequenas variações uns dos outros podem não gerar a diversidade de respostas necessária para o benefício do *ensembling*. 4. **Complexidade de Implementação:** Abordagens avançadas como DiVeRSe ou Boosted Ensembles exigem treinamento de modelos adicionais (verificadores) ou um processo de seleção de exemplos complexo.

## URL
[https://learnprompting.org/docs/reliability/ensembling?srsltid=AfmBOooXXu_ajllm30ejOZj7kZ3bu2GhXNfZ-6sbRmNWRWmOnwijgmQ_](https://learnprompting.org/docs/reliability/ensembling?srsltid=AfmBOooXXu_ajllm30ejOZj7kZ3bu2GhXNfZ-6sbRmNWRWmOnwijgmQ_)
